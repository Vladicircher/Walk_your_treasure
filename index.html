<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –º–∞—Ä–∞—Ñ–æ–Ω —à–∞–≥–æ–≤ ‚Äî 9 –¥–Ω–µ–π</title>
  <style>
    :root{
      --bg0:#060913;
      --bg1:#0b1020;
      --card: rgba(255,255,255,.08);
      --text:#eef2ff;
      --muted: rgba(238,242,255,.74);
      --line: rgba(255,255,255,.14);
      --shadow: 0 20px 55px rgba(0,0,0,.38);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      min-height:100vh;
      overflow-x:hidden;
      background:
        radial-gradient(900px 700px at 15% 15%, rgba(139,92,246,.22), transparent 60%),
        radial-gradient(1000px 700px at 90% 20%, rgba(34,197,94,.18), transparent 58%),
        radial-gradient(900px 700px at 60% 95%, rgba(245,158,11,.15), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 55%, var(--bg0));
    }

    /* New Year decor (SVG) */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.95;
      background:
        url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='1600' height='900' viewBox='0 0 1600 900'>\
  <defs>\
    <linearGradient id='g1' x1='0' y1='0' x2='0' y2='1'>\
      <stop offset='0' stop-color='%23000' stop-opacity='0'/>\
      <stop offset='1' stop-color='%23000' stop-opacity='.35'/>\
    </linearGradient>\
    <filter id='glow'>\
      <feGaussianBlur stdDeviation='2.5' result='b'/>\
      <feMerge><feMergeNode in='b'/><feMergeNode in='SourceGraphic'/></feMerge>\
    </filter>\
  </defs>\
  <g opacity='.95'>\
    <path d='M0 140 C220 60, 360 220, 560 140 C760 60, 920 220, 1120 140 C1320 60, 1460 220, 1600 140 L1600 0 L0 0 Z' fill='%230b1f1a'/>\
    <path d='M0 170 C240 90, 380 250, 580 170 C780 90, 940 250, 1140 170 C1340 90, 1480 250, 1600 170' fill='none' stroke='%231f7a4b' stroke-opacity='.45' stroke-width='20'/>\
    <path d='M0 170 C240 90, 380 250, 580 170 C780 90, 940 250, 1140 170 C1340 90, 1480 250, 1600 170' fill='none' stroke='%230a3b25' stroke-opacity='.55' stroke-width='34'/>\
  </g>\
  <path d='M80 165 C300 120, 420 220, 620 165 C820 110, 980 240, 1240 165 C1400 120, 1500 210, 1560 175' fill='none' stroke='%23ffd166' stroke-opacity='.25' stroke-width='6' filter='url(%23glow)'/>\
  <g filter='url(%23glow)'>\
    <circle cx='150' cy='168' r='6' fill='%23ffd166'/>\
    <circle cx='260' cy='152' r='6' fill='%23ff6b6b'/>\
    <circle cx='395' cy='178' r='6' fill='%234cc9f0'/>\
    <circle cx='520' cy='160' r='6' fill='%23f72585'/>\
    <circle cx='700' cy='150' r='6' fill='%23ffd166'/>\
    <circle cx='860' cy='182' r='6' fill='%234cc9f0'/>\
    <circle cx='1030' cy='160' r='6' fill='%23ff6b6b'/>\
    <circle cx='1210' cy='178' r='6' fill='%23ffd166'/>\
    <circle cx='1400' cy='158' r='6' fill='%23f72585'/>\
    <circle cx='1530' cy='175' r='6' fill='%234cc9f0'/>\
  </g>\
  <g opacity='.95'>\
    <circle cx='310' cy='210' r='18' fill='%23ff4d6d'/>\
    <circle cx='310' cy='210' r='18' fill='url(%23g1)'/>\
    <rect x='305' y='186' width='10' height='8' rx='2' fill='%23c0c0c0'/>\
    <circle cx='910' cy='220' r='18' fill='%234cc9f0'/>\
    <circle cx='910' cy='220' r='18' fill='url(%23g1)'/>\
    <rect x='905' y='196' width='10' height='8' rx='2' fill='%23c0c0c0'/>\
    <circle cx='1330' cy='212' r='18' fill='%23ffd166'/>\
    <circle cx='1330' cy='212' r='18' fill='url(%23g1)'/>\
    <rect x='1325' y='188' width='10' height='8' rx='2' fill='%23c0c0c0'/>\
  </g>\
  <g opacity='.9'>\
    <path d='M0 900 L0 770 C260 820, 360 660, 560 760 C760 860, 940 650, 1140 760 C1340 870, 1460 700, 1600 770 L1600 900 Z' fill='%230b1f1a'/>\
    <path d='M0 770 C250 820, 380 680, 560 760 C760 850, 940 670, 1140 760 C1320 840, 1480 710, 1600 770' fill='none' stroke='%231f7a4b' stroke-opacity='.45' stroke-width='22'/>\
    <path d='M0 770 C250 820, 380 680, 560 760 C760 850, 940 670, 1140 760 C1320 840, 1480 710, 1600 770' fill='none' stroke='%230a3b25' stroke-opacity='.55' stroke-width='36'/>\
  </g>\
  <g opacity='.35'>\
    <circle cx='120' cy='360' r='2' fill='%23ffffff'/>\
    <circle cx='520' cy='420' r='2' fill='%23ffffff'/>\
    <circle cx='860' cy='350' r='2' fill='%23ffffff'/>\
    <circle cx='1220' cy='430' r='2' fill='%23ffffff'/>\
    <circle cx='1480' cy='380' r='2' fill='%23ffffff'/>\
  </g>\
</svg>") center / cover no-repeat;
      mix-blend-mode: screen;
    }
    body::after{
      content:"";
      position:fixed;
      inset:-50px;
      pointer-events:none;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.10) 0 2px, transparent 3px) 0 0/220px 220px,
        radial-gradient(circle at 70% 40%, rgba(255,255,255,.08) 0 1.5px, transparent 3px) 0 0/260px 260px,
        radial-gradient(circle at 40% 80%, rgba(255,255,255,.06) 0 1.5px, transparent 3px) 0 0/300px 300px;
      opacity:.55;
      animation: drift 18s linear infinite;
    }
    @keyframes drift{ from{ transform: translateY(-10px);} to{ transform: translateY(30px);} }

    header{
      max-width:1200px;
      margin: 26px auto 14px;
      padding: 0 18px;
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
      position:relative;
      z-index:1;
    }
    .title{ display:flex; flex-direction:column; gap:6px; }
    h1{
      margin:0;
      font-size: clamp(22px, 3.4vw, 34px);
      letter-spacing:.2px;
      line-height:1.15;
      text-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .subtitle{ color:var(--muted); font-size:14px; max-width: 90ch; }

    .toolbar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .pill{
      background: var(--card);
      border:1px solid var(--line);
      padding: 10px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow);
      display:flex; gap:10px; align-items:center;
      backdrop-filter: blur(10px);
    }
    .pill label{ font-size:12px; color:var(--muted); white-space:nowrap; }
    .pill input, .pill select{
      background: transparent; border:none; outline:none;
      color: var(--text);
      font-weight: 900;
      font-size: 13px;
      min-width: 92px;
    }

    .btn{
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      cursor:pointer;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      font-weight: 900;
      font-size: 13px;
      transition: transform .06s ease, border-color .2s ease, filter .2s ease;
      user-select:none;
      position:relative;
      z-index:1;
    }
    .btn:hover{ border-color: rgba(139,92,246,.65); filter: brightness(1.04); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      border-color: rgba(139,92,246,.65);
      background: linear-gradient(180deg, rgba(139,92,246,.65), rgba(139,92,246,.22));
    }
    .btn.danger{
      border-color: rgba(239,68,68,.55);
      background: linear-gradient(180deg, rgba(239,68,68,.35), rgba(239,68,68,.12));
    }
    .btn.success{
      border-color: rgba(34,197,94,.55);
      background: linear-gradient(180deg, rgba(34,197,94,.30), rgba(34,197,94,.12));
    }
    .btn.locked{
      border-color: rgba(245,158,11,.60);
      background: linear-gradient(180deg, rgba(245,158,11,.32), rgba(245,158,11,.12));
    }
    .btn.ghost{
      border-color: rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
    }

    main{
      max-width:1200px;
      margin: 0 auto 44px;
      padding: 0 18px;
      position:relative;
      z-index:1;
    }
    .grid{ display:grid; grid-template-columns: 1fr; gap: 14px; }
    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .cardhead{
      padding: 14px 16px;
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .cardhead .left{ display:flex; flex-direction:column; gap:4px; }
    .cardhead .left .small{ color:var(--muted); font-size:12px; }
    .cardhead .right{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(238,242,255,.78);
    }
    .badge strong{ font-family: var(--sans); font-weight: 900; color: var(--text); }

    .tablewrap{ overflow:auto; -webkit-overflow-scrolling: touch; }
    table{
      width:100%;
      border-collapse: separate;
      border-spacing:0;
      min-width: 980px;
      font-variant-numeric: tabular-nums;
    }
    thead th{
      position: sticky;
      top: 0;
      z-index: 2;
      background: rgba(12,16,35,.92);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .08em;
      padding: 12px 10px;
      text-align: center;
      white-space: nowrap;
    }
    thead th:first-child{ text-align:left; padding-left: 14px; }
    tbody td{
      border-bottom: 1px solid rgba(255,255,255,.07);
      padding: 10px 10px;
      text-align:center;
      vertical-align: middle;
    }
    tbody tr:hover td{ background: rgba(255,255,255,.03); }
    tbody td:first-child{ text-align:left; padding-left: 14px; }

    .namecell{ display:flex; align-items:center; justify-content: space-between; gap: 10px; }
    .name{ font-weight: 950; letter-spacing:.2px; }
    .rank{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      padding: 6px 8px;
      border-radius: 999px;
      white-space: nowrap;
    }
    .viewerValue{
      display:inline-block;
      min-width: 92px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      text-align: right;
      font-weight: 900;
      font-family: var(--mono);
      color: rgba(238,242,255,.92);
    }

    .step{
      width: 118px;
      max-width: 118px;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.16);
      border-radius: 12px;
      padding: 9px 10px;
      outline: none;
      color: var(--text);
      font-weight: 950;
      text-align: right;
      transition: border-color .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .step:focus{
      border-color: rgba(139,92,246,.75);
      box-shadow: 0 0 0 3px rgba(139,92,246,.25);
    }
    .step.locked{
      opacity: .55;
      filter: grayscale(.25);
      cursor: not-allowed;
    }
    .step.today{
      border-color: rgba(245,158,11,.65);
      box-shadow: 0 0 0 3px rgba(245,158,11,.20);
    }

    .total{
      font-weight: 950;
      text-align: right;
      padding-right: 14px;
      white-space: nowrap;
    }
    .total small{
      display:block;
      font-size: 11px;
      color: var(--muted);
      font-weight: 700;
      margin-top: 2px;
      text-align:right;
    }

    .winner{
      background: linear-gradient(90deg, rgba(34,197,94,.18), rgba(139,92,246,.12));
    }
    .winner .name::after{ content:" üëë"; }

    .note{
      padding: 12px 16px;
      color: var(--muted);
      font-size: 13px;
      border-top: 1px solid var(--line);
    }
    .footerline{
      padding: 10px 16px 14px;
      color: rgba(238,242,255,.60);
      font-size: 12px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .kbd{
      font-family: var(--mono);
      padding: 2px 6px;
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 8px;
      background: rgba(255,255,255,.06);
      color: rgba(238,242,255,.75);
    }

    .io{
      width: 100%;
      min-height: 140px;
      background: rgba(0,0,0,.25);
      border: 1px dashed rgba(255,255,255,.2);
      border-radius: 14px;
      padding: 12px 12px;
      color: var(--text);
      font-family: var(--mono);
      font-size: 12px;
      outline:none;
    }
    .io:focus{
      border-color: rgba(139,92,246,.65);
      box-shadow: 0 0 0 3px rgba(139,92,246,.22);
    }
    .hidden{ display:none; }

    /* ===== Mode visibility ===== */
    .adminOnly{ display:none !important; }
    .viewerOnly{ display: initial; }
    body.admin .adminOnly{ display: initial !important; }
    body.admin .viewerOnly{ display:none !important; }

    /* Viewer mode: hide ALL extra controls, keep only table + title + winner */
    body:not(.admin) .pill,
    body:not(.admin) #addBtn,
    body:not(.admin) #exportBtn,
    body:not(.admin) #importBtn,
    body:not(.admin) #resetBtn,
    body:not(.admin) #lockDayBtn,
    body:not(.admin) #toggleMissingBtn,
    body:not(.admin) #sortToggleBtn,
    body:not(.admin) #ioCard,
    body:not(.admin) .note {
      display:none !important;
    }
    /* Keep admin button always visible */
    #adminBtn{ display:inline-flex; }
 /* ===== –ü–∞–¥–∞—é—â–∏–µ —Å–Ω–µ–∂–∏–Ω–∫–∏ ===== */
.snow {
  pointer-events: none;
  position: fixed;
  inset: 0;
  z-index: 9999;
}

.snow span {
  position: absolute;
  top: -10px;
  width: 6px;
  height: 6px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  filter: blur(0.2px);
  animation: fall linear infinite;
  opacity: 0.8;
}

@keyframes fall {
  to {
    transform: translateY(110vh);
  }
}  </style>
</head>

<body>

<div class="snow" aria-hidden="true">
 <span style="left:2%; animation-duration:9s;"></span>
  <span style="left:4%; animation-duration:11s;"></span>
  <span style="left:6%; animation-duration:13s;"></span>
  <span style="left:8%; animation-duration:10s;"></span>
  <span style="left:10%; animation-duration:14s;"></span>

  <span style="left:15%; animation-duration:12s;"></span>
  <span style="left:18%; animation-duration:9s;"></span>
  <span style="left:22%; animation-duration:15s;"></span>
  <span style="left:25%; animation-duration:11s;"></span>
  <span style="left:28%; animation-duration:13s;"></span>

  <span style="left:32%; animation-duration:10s;"></span>
  <span style="left:36%; animation-duration:14s;"></span>
  <span style="left:40%; animation-duration:12s;"></span>
  <span style="left:44%; animation-duration:9s;"></span>
  <span style="left:48%; animation-duration:15s;"></span>

  <span style="left:52%; animation-duration:11s;"></span>
  <span style="left:56%; animation-duration:13s;"></span>
  <span style="left:60%; animation-duration:10s;"></span>
  <span style="left:64%; animation-duration:14s;"></span>
  <span style="left:68%; animation-duration:12s;"></span>

  <span style="left:72%; animation-duration:9s;"></span>
  <span style="left:76%; animation-duration:15s;"></span>
  <span style="left:80%; animation-duration:11s;"></span>
  <span style="left:84%; animation-duration:13s;"></span>
  <span style="left:88%; animation-duration:10s;"></span>

  <span style="left:92%; animation-duration:14s;"></span>
  <span style="left:96%; animation-duration:12s;"></span>
  <span style="left:98%; animation-duration:9s;"></span>
</div>

<!-- –¥–∞–ª—å—à–µ –∏–¥—ë—Ç —Ç–≤–æ–π —Å–∞–π—Ç -->
...

  <header>
    <div class="title">
      <h1>–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –º–∞—Ä–∞—Ñ–æ–Ω —à–∞–≥–æ–≤ üéÑ‚ú®</h1>
      <div class="subtitle adminOnly">–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, —à–∞–≥–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.</div>
      <div class="subtitle viewerOnly">–¢–∞–±–ª–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞: –∏–º–µ–Ω–∞, —à–∞–≥–∏ –ø–æ –¥–Ω—è–º –∏ —Å—É–º–º–∞. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ.</div>
    </div>

    <div class="toolbar">
      <div class="pill adminOnly">
        <label for="days">–î–Ω–µ–π:</label>
        <select id="days">
          <option value="9" selected>9</option>
          <option value="7">7</option>
          <option value="10">10</option>
          <option value="14">14</option>
        </select>
      </div>

      <div class="pill adminOnly">
        <label for="dayNames">–ü–æ–¥–ø–∏—Å–∏:</label>
        <select id="dayNames">
          <option value="Day" selected>–î–µ–Ω—å 1‚Ä¶</option>
          <option value="Date">–î–∞—Ç—ã</option>
        </select>
      </div>

      <button class="btn primary adminOnly" id="addBtn">+ –£—á–∞—Å—Ç–Ω–∏–∫</button>
      <button class="btn adminOnly" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
      <button class="btn adminOnly" id="importBtn">–ò–º–ø–æ—Ä—Ç</button>
      <button class="btn danger adminOnly" id="resetBtn">–°–±—Ä–æ—Å</button>

      <button class="btn locked adminOnly" id="lockDayBtn" title="–ï—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç—å ‚Äî –≤–≤–æ–¥ —Ç–æ–ª—å–∫–æ –≤ –∞–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å">üîí –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–µ–Ω—å</button>
      <button class="btn success adminOnly" id="toggleMissingBtn" title="–ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å —Ç–µ—Ö, –∫—Ç–æ –Ω–µ –ø—Ä–∏—Å–ª–∞–ª —à–∞–≥–∏ –∑–∞ –∞–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å">‚ùó –ö—Ç–æ –Ω–µ —Å–¥–∞–ª —Å–µ–≥–æ–¥–Ω—è</button>
      <button class="btn adminOnly" id="sortToggleBtn">–°–æ—Ä—Ç: <span id="sortModeLabel">–ø–æ —Å—É–º–º–µ</span></button>

      <button class="btn ghost" id="adminBtn" title="–í–æ–π—Ç–∏/–≤—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">üîë –ê–¥–º–∏–Ω: <span id="adminStateLabel">–≤—Ö–æ–¥</span></button>
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="card">
        <div class="cardhead">
          <div class="left">
            <div style="font-weight:950;">–¢–∞–±–ª–∏—Ü–∞ —à–∞–≥–æ–≤</div>
            <div class="small adminOnly" id="statusLine">–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.</div>
            <div class="badge adminOnly">–ê–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å: <strong id="activeDayLabel">‚Äî</strong></div>
          </div>

          <div class="right adminOnly">
            <div class="pill" style="box-shadow:none;">
              <label for="startDate">–°—Ç–∞—Ä—Ç:</label>
              <input id="startDate" type="date" />
            </div>
            <div class="pill" style="box-shadow:none;">
              <label for="activeDaySelect">–î–µ–Ω—å:</label>
              <select id="activeDaySelect"></select>
            </div>
          </div>
        </div>

        <div class="tablewrap">
          <table id="table">
            <thead id="thead"></thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>

        <div class="note adminOnly">
          <span class="kbd">Tab</span> ‚Äî —Å–ª–µ–¥—É—é—â–∞—è —è—á–µ–π–∫–∞ ¬∑
          <span class="kbd">–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫</span> –ø–æ –∏–º–µ–Ω–∏ ‚Äî –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å ¬∑
          <span class="kbd">–ü–ö–ú</span> –ø–æ —Å—Ç—Ä–æ–∫–µ ‚Äî —É–¥–∞–ª–∏—Ç—å.
        </div>

        <div class="footerline">
          <div>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å ‚Äî –∫—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π.</div>
          <div id="winnerLine"></div>
        </div>
      </section>

      <section class="card hidden adminOnly" id="ioCard">
        <div class="cardhead">
          <div class="left">
            <div style="font-weight:950;">–ò–º–ø–æ—Ä—Ç / –≠–∫—Å–ø–æ—Ä—Ç</div>
            <div class="small">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ JSON –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞.</div>
          </div>
          <div class="right">
            <button class="btn" id="closeIoBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
          </div>
        </div>
        <div style="padding: 14px 16px;">
          <textarea class="io" id="ioBox" placeholder="–ó–¥–µ—Å—å –±—É–¥–µ—Ç JSON..."></textarea>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
            <button class="btn primary" id="applyImportBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç</button>
            <button class="btn" id="copyBtn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn" id="downloadBtn">–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª .json</button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    // ===== ADMIN MODE =====
    const ADMIN_PASSWORD = "itissnowingnow"; // <-- –ü–û–ú–ï–ù–Ø–ô–¢–ï –ù–ê –°–í–û–ô
    const ADMIN_KEY = "walk_marathon_admin_ok_v2";

    function hashLight(s){
      let h = 2166136261;
      for (let i=0;i<s.length;i++){
        h ^= s.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return (h>>>0).toString(16);
    }
    const ADMIN_HASH = hashLight(ADMIN_PASSWORD);

    function isAdmin(){ return localStorage.getItem(ADMIN_KEY) === ADMIN_HASH; }

    function setAdmin(v){
      if (v) localStorage.setItem(ADMIN_KEY, ADMIN_HASH);
      else localStorage.removeItem(ADMIN_KEY);
      applyAdminUI();
      render();
    }

    // ===== APP =====
    const STORAGE_KEY = "walk_marathon_newyear_admin_view_v1";

    const DEFAULT = () => ({
      days: 9,
      dayNamesMode: "Day",
      startDate: "",
      sortMode: "total",
      participants: [],
      activeDayIndex: 0,
      lockDay: false,
      highlightMissing: false
    });

    let state = load() ?? DEFAULT();

    const $ = (sel) => document.querySelector(sel);
    const clamp = (n,min,max) => Math.max(min, Math.min(max, n));

    function uid(){ return Math.random().toString(16).slice(2) + Date.now().toString(16); }

    function normalizeNumber(value){
      const s = String(value ?? "").replace(/\s+/g,"").replace(/,/g,"").trim();
      if (!s) return 0;
      const n = Number(s);
      return Number.isFinite(n) && n >= 0 ? Math.floor(n) : 0;
    }

    function fmt(n){ return (n ?? 0).toLocaleString("ru-RU"); }

    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      const st = document.getElementById("statusLine");
      if (st) st.textContent = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: " + new Date().toLocaleString("ru-RU");
    }

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        return JSON.parse(raw);
      }catch{ return null; }
    }

    function ensureStepsLength(){
      const d = Number(state.days) || 9;
      for (const p of state.participants){
        if (!Array.isArray(p.steps)) p.steps = [];
        if (p.steps.length < d) p.steps = p.steps.concat(new Array(d - p.steps.length).fill(0));
        if (p.steps.length > d) p.steps = p.steps.slice(0, d);
      }
      state.activeDayIndex = clamp(Number(state.activeDayIndex)||0, 0, d-1);
    }

    function totalSteps(p){
      return (p.steps || []).reduce((a,b)=>a + normalizeNumber(b), 0);
    }

    function sortParticipants(list){
      const mode = state.sortMode;
      const arr = [...list];
      if (mode === "name"){
        arr.sort((a,b) => (a.name||"").localeCompare(b.name||"", "ru"));
      } else {
        arr.sort((a,b) => totalSteps(b) - totalSteps(a) || (a.name||"").localeCompare(b.name||"", "ru"));
      }
      return arr;
    }

    function getWinner(sorted){
      if (!sorted.length) return null;
      const top = totalSteps(sorted[0]);
      if (top <= 0) return null;
      const winners = sorted.filter(p => totalSteps(p) === top);
      return { top, winners };
    }

    function getDayLabels(){
      const d = Number(state.days) || 9;
      const labels = [];
      if (state.dayNamesMode === "Date" && state.startDate){
        const start = new Date(state.startDate + "T00:00:00");
        for (let i=0;i<d;i++){
          const dt = new Date(start);
          dt.setDate(start.getDate() + i);
          labels.push(dt.toLocaleDateString("ru-RU", { day:"2-digit", month:"2-digit" }));
        }
      } else {
        for (let i=0;i<d;i++) labels.push("–î–µ–Ω—å " + (i+1));
      }
      return labels;
    }

    function renderActiveDaySelect(){
      const sel = document.getElementById("activeDaySelect");
      if (!sel) return;
      sel.innerHTML = "";
      const labels = getDayLabels();
      labels.forEach((lab, i) => {
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = lab;
        sel.appendChild(opt);
      });
      sel.value = String(state.activeDayIndex);
      const lbl = document.getElementById("activeDayLabel");
      if (lbl) lbl.textContent = labels[state.activeDayIndex] ?? ("–î–µ–Ω—å " + (state.activeDayIndex+1));
    }

    function applyAdminUI(){
      const admin = isAdmin();
      document.body.classList.toggle("admin", admin);
      document.getElementById("adminStateLabel").textContent = admin ? "–≤–∫–ª" : "–≤—Ö–æ–¥";

      const ids = ["days","dayNames","startDate","activeDaySelect"];
      for (const id of ids){
        const el = document.getElementById(id);
        if (el) el.disabled = !admin;
      }
    }

    function paintLocking(){
      if (!isAdmin()) return;

      const lockBtn = document.getElementById("lockDayBtn");
      if (lockBtn){
        lockBtn.classList.toggle("locked", state.lockDay);
        lockBtn.textContent = state.lockDay ? "üîì –°–Ω—è—Ç—å —Ñ–∏–∫—Å–∞—Ü–∏—é –¥–Ω—è" : "üîí –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–µ–Ω—å";
      }

      const tbody = document.getElementById("tbody");
      const inputs = [...tbody.querySelectorAll("input.step")];
      for (const inp of inputs){
        const d = Number(inp.dataset.day);
        const isToday = d === state.activeDayIndex;
        inp.classList.toggle("today", isToday);

        if (state.lockDay){
          const locked = !isToday;
          inp.disabled = locked;
          inp.classList.toggle("locked", locked);
        } else {
          inp.disabled = false;
          inp.classList.remove("locked");
        }
      }
    }

    function paintLite(){
      if (!isAdmin()) return;
      const tbody = document.getElementById("tbody");
      const rows = [...tbody.querySelectorAll("tr")];
      let best = -1;
      for (const r of rows){
        const id = r.dataset.id;
        const p = state.participants.find(x => x.id === id);
        if (!p) continue;
        const total = totalSteps(p);
        const totalCell = r.querySelector("td.total");
        if (totalCell) totalCell.innerHTML = `${fmt(total)} <small>—à–∞–≥–æ–≤</small>`;
        if (total > best) best = total;
      }
      for (const r of rows){
        const id = r.dataset.id;
        const p = state.participants.find(x => x.id === id);
        if (!p) continue;
        r.classList.toggle("winner", totalSteps(p) === best && best > 0);
      }
    }

    function render(){
      ensureStepsLength();

      const daysSel = document.getElementById("days");
      if (daysSel) daysSel.value = String(state.days);

      const dayNamesSel = document.getElementById("dayNames");
      if (dayNamesSel) dayNamesSel.value = state.dayNamesMode;

      const startDate = document.getElementById("startDate");
      if (startDate) startDate.value = state.startDate || "";

      const sortModeLabel = document.getElementById("sortModeLabel");
      if (sortModeLabel) sortModeLabel.textContent = state.sortMode === "name" ? "–ø–æ –∏–º–µ–Ω–∏" : "–ø–æ —Å—É–º–º–µ";

      renderActiveDaySelect();

      const labels = getDayLabels();

      // head
      const thead = document.getElementById("thead");
      thead.innerHTML = "";
      const tr = document.createElement("tr");

      const thName = document.createElement("th");
      thName.textContent = "–£—á–∞—Å—Ç–Ω–∏–∫";
      tr.appendChild(thName);

      labels.forEach((lab, idx) => {
        const th = document.createElement("th");
        th.textContent = lab;
        if (isAdmin() && idx === state.activeDayIndex) th.style.color = "rgba(245,158,11,.95)";
        tr.appendChild(th);
      });

      const thTotal = document.createElement("th");
      thTotal.textContent = "–°—É–º–º–∞";
      tr.appendChild(thTotal);
      thead.appendChild(tr);

      // body
      const tbody = document.getElementById("tbody");
      tbody.innerHTML = "";

      const sorted = sortParticipants(state.participants);
      const winnerInfo = getWinner(sorted);

      for (const p of sorted){
        const row = document.createElement("tr");
        row.dataset.id = p.id;

        const tdName = document.createElement("td");
        const wrap = document.createElement("div");
        wrap.className = "namecell";

        const nameSpan = document.createElement("span");
        nameSpan.className = "name";
        nameSpan.textContent = p.name || "–ë–µ–∑ –∏–º–µ–Ω–∏";

        const rank = document.createElement("span");
        rank.className = "rank";
        rank.textContent = fmt(totalSteps(p));

        wrap.appendChild(nameSpan);
        wrap.appendChild(rank);
        tdName.appendChild(wrap);

        tdName.ondblclick = () => {
          if (!isAdmin()) return;
          const newName = prompt("–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞:", p.name || "");
          if (newName === null) return;
          p.name = (newName || "").trim() || "–ë–µ–∑ –∏–º–µ–Ω–∏";
          save();
          render();
        };

        row.appendChild(tdName);

        for (let d=0; d<state.days; d++){
          const td = document.createElement("td");
          if (isAdmin()){
            const input = document.createElement("input");
            input.className = "step";
            input.inputMode = "numeric";
            input.placeholder = "0";
            input.value = p.steps[d] ? String(p.steps[d]) : "";
            input.dataset.day = String(d);

            input.addEventListener("input", (e) => {
              const n = normalizeNumber(e.target.value);
              p.steps[d] = n;
              save();
              paintLite();
            });

            input.addEventListener("blur", (e) => {
              const n = normalizeNumber(e.target.value);
              p.steps[d] = n;
              e.target.value = n ? String(n) : "";
              save();
              render();
            });

            td.appendChild(input);
          } else {
            const span = document.createElement("span");
            span.className = "viewerValue";
            span.textContent = fmt(normalizeNumber(p.steps[d]));
            td.appendChild(span);
          }
          row.appendChild(td);
        }

        const tdTotal = document.createElement("td");
        tdTotal.className = "total";
        tdTotal.innerHTML = `${fmt(totalSteps(p))} <small>—à–∞–≥–æ–≤</small>`;
        row.appendChild(tdTotal);

        const isWinnerRow = winnerInfo && winnerInfo.winners.some(w => w.id === p.id);
        if (isWinnerRow) row.classList.add("winner");

        row.addEventListener("contextmenu", (e) => {
          e.preventDefault();
          if (!isAdmin()) return;
          const ok = confirm(`–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ "${p.name}"?`);
          if (!ok) return;
          state.participants = state.participants.filter(x => x.id !== p.id);
          save();
          render();
        });

        tbody.appendChild(row);
      }

      const winnerLine = document.getElementById("winnerLine");
      if (!winnerInfo){
        winnerLine.textContent = "–ü–æ–∫–∞ –ª–∏–¥–µ—Ä –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω (–∏–ª–∏ —à–∞–≥–æ–≤ –µ—â—ë –Ω–µ—Ç).";
      } else {
        const names = winnerInfo.winners.map(w => w.name || "–ë–µ–∑ –∏–º–µ–Ω–∏").join(", ");
        winnerLine.textContent = `–õ–∏–¥–µ—Ä: ${names} ‚Äî ${fmt(winnerInfo.top)} —à–∞–≥–æ–≤.`;
      }

      paintLocking();
    }

    // ===== Admin actions =====
    function addParticipant(){
      if (!isAdmin()) return;
      const name = (prompt("–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞:") || "").trim();
      if (!name) return;
      ensureStepsLength();
      state.participants.push({ id: uid(), name, steps: new Array(state.days).fill(0) });
      save();
      render();
    }

    function resetAll(){
      if (!isAdmin()) return;
      const ok = confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë? –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∏ —à–∞–≥–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.");
      if (!ok) return;
      localStorage.removeItem(STORAGE_KEY);
      state = DEFAULT();
      save();
      render();
    }

    function openIO(mode){
      if (!isAdmin()) return;
      const card = document.getElementById("ioCard");
      card.classList.remove("hidden");
      const box = document.getElementById("ioBox");
      if (mode === "export"){
        box.value = JSON.stringify(state, null, 2);
        box.focus(); box.select();
      } else {
        box.value = "";
        box.placeholder = "–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ JSON –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞‚Ä¶";
        box.focus();
      }
      card.dataset.mode = mode;
    }

    function closeIO(){
      if (!isAdmin()) return;
      document.getElementById("ioCard").classList.add("hidden");
    }

    function applyImport(){
      if (!isAdmin()) return;
      const txt = document.getElementById("ioBox").value.trim();
      if (!txt){ alert("–ü–æ–ª–µ –ø—É—Å—Ç–æ–µ ‚Äî –Ω–µ—á–µ–≥–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å."); return; }
      try{
        const obj = JSON.parse(txt);
        const next = DEFAULT();
        next.days = clamp(Number(obj.days ?? 9) || 9, 1, 31);
        next.dayNamesMode = (obj.dayNamesMode === "Date" ? "Date" : "Day");
        next.startDate = typeof obj.startDate === "string" ? obj.startDate : "";
        next.sortMode = (obj.sortMode === "name" ? "name" : "total");
        next.participants = Array.isArray(obj.participants) ? obj.participants.map(p => ({
          id: p.id || uid(),
          name: (p.name || "–ë–µ–∑ –∏–º–µ–Ω–∏").toString(),
          steps: Array.isArray(p.steps) ? p.steps.map(normalizeNumber) : []
        })) : [];
        next.activeDayIndex = clamp(Number(obj.activeDayIndex)||0, 0, next.days-1);
        next.lockDay = Boolean(obj.lockDay);
        next.highlightMissing = Boolean(obj.highlightMissing);

        state = next;
        ensureStepsLength();
        save();
        render();
        alert("–ò–º–ø–æ—Ä—Ç –ø—Ä–∏–º–µ–Ω—ë–Ω ‚úÖ");
        closeIO();
      }catch(e){
        alert("–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON.\n\n" + e.message);
      }
    }

    async function copyIO(){
      if (!isAdmin()) return;
      try{ await navigator.clipboard.writeText(document.getElementById("ioBox").value); alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ"); }
      catch{ alert("–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –í—ã–¥–µ–ª–∏—Ç–µ –∏ Ctrl+C."); }
    }

    function downloadJSON(){
      if (!isAdmin()) return;
      const blob = new Blob([document.getElementById("ioBox").value], { type:"application/json;charset=utf-8" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "marathon-steps.json";
      document.body.appendChild(a);
      a.click();
      URL.revokeObjectURL(a.href);
      a.remove();
    }

    // ===== Wire up =====
    document.getElementById("adminBtn").addEventListener("click", () => {
      if (isAdmin()){
        const ok = confirm("–í—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞?");
        if (!ok) return;
        setAdmin(false);
        return;
      }
      const pwd = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:");
      if (pwd === null) return;
      if (hashLight(pwd) === ADMIN_HASH){
        setAdmin(true);
        alert("–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤–∫–ª—é—á—ë–Ω ‚úÖ");
      } else {
        alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.");
      }
    });

    const addBtn = document.getElementById("addBtn");
    if (addBtn) addBtn.addEventListener("click", addParticipant);

    const resetBtn = document.getElementById("resetBtn");
    if (resetBtn) resetBtn.addEventListener("click", resetAll);

    const lockDayBtn = document.getElementById("lockDayBtn");
    if (lockDayBtn) lockDayBtn.addEventListener("click", () => {
      if (!isAdmin()) return;
      state.lockDay = !state.lockDay;
      save();
      paintLocking();
    });

    const sortToggleBtn = document.getElementById("sortToggleBtn");
    if (sortToggleBtn) sortToggleBtn.addEventListener("click", () => {
      if (!isAdmin()) return;
      state.sortMode = state.sortMode === "total" ? "name" : "total";
      save();
      render();
    });

    const daysSel = document.getElementById("days");
    if (daysSel) daysSel.addEventListener("change", (e) => {
      if (!isAdmin()) { applyAdminUI(); return; }
      state.days = clamp(Number(e.target.value) || 9, 1, 31);
      ensureStepsLength();
      save();
      render();
    });

    const dayNamesSel = document.getElementById("dayNames");
    if (dayNamesSel) dayNamesSel.addEventListener("change", (e) => {
      if (!isAdmin()) { applyAdminUI(); return; }
      state.dayNamesMode = e.target.value === "Date" ? "Date" : "Day";
      save();
      render();
    });

    const startDate = document.getElementById("startDate");
    if (startDate) startDate.addEventListener("change", (e) => {
      if (!isAdmin()) { applyAdminUI(); return; }
      state.startDate = e.target.value || "";
      save();
      render();
    });

    const activeDaySelect = document.getElementById("activeDaySelect");
    if (activeDaySelect) activeDaySelect.addEventListener("change", (e) => {
      if (!isAdmin()) { applyAdminUI(); return; }
      state.activeDayIndex = clamp(Number(e.target.value)||0, 0, (Number(state.days)||9)-1);
      save();
      renderActiveDaySelect();
      paintLocking();
    });

    const exportBtn = document.getElementById("exportBtn");
    if (exportBtn) exportBtn.addEventListener("click", () => openIO("export"));

    const importBtn = document.getElementById("importBtn");
    if (importBtn) importBtn.addEventListener("click", () => openIO("import"));

    const closeIoBtn = document.getElementById("closeIoBtn");
    if (closeIoBtn) closeIoBtn.addEventListener("click", closeIO);

    const applyImportBtn = document.getElementById("applyImportBtn");
    if (applyImportBtn) applyImportBtn.addEventListener("click", applyImport);

    const copyBtn = document.getElementById("copyBtn");
    if (copyBtn) copyBtn.addEventListener("click", copyIO);

    const downloadBtn = document.getElementById("downloadBtn");
    if (downloadBtn) downloadBtn.addEventListener("click", downloadJSON);

    // First run
    ensureStepsLength();
    save();
    applyAdminUI();
    render();
  </script>
</body>
</html>
